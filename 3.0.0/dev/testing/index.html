
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for Kamihi, a Python framework for rapid Telegram bot development and management
">
      
      
        <meta name="author" content="kiinami">
      
      
        <link rel="canonical" href="https://kamihi-org.github.io/kamihi/3.0.0/dev/testing/">
      
      
        <link rel="prev" href="../setup/">
      
      
        <link rel="next" href="../documentation/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Testing - Kamihi documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../termynal.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unit-testing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Kamihi documentation" class="md-header__button md-logo" aria-label="Kamihi documentation" data-md-component="logo">
      
  <img src="https://api.iconify.design/flowbite:paper-plane-solid.svg?color=%23FFFFFF" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kamihi documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Testing
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/kamihi-org/kamihi" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    kamihi-org/kamihi
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorials/" class="md-tabs__link">
          
  
  
    
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/" class="md-tabs__link">
          
  
  
    
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../reference/cli/" class="md-tabs__link">
        
  
  
    
  
  CLI reference

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/kamihi/" class="md-tabs__link">
          
  
  
    
  
  API reference

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  Developers

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../changelog/" class="md-tabs__link">
          
  
  
    
  
  About

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Kamihi documentation" class="md-nav__button md-logo" aria-label="Kamihi documentation" data-md-component="logo">
      
  <img src="https://api.iconify.design/flowbite:paper-plane-solid.svg?color=%23FFFFFF" alt="logo">

    </a>
    Kamihi documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/kamihi-org/kamihi" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    kamihi-org/kamihi
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tutorials/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/your-first-bot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Your first bot
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/adding-actions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Adding actions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/key-concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Key concepts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/config/load-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Load configuration from a file
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/config/load-environment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Load configuration from environment variables
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/config/load-prog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Set configuration values programmatically
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/config/configure-timezone/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configure the timezone
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Actions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Actions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/actions/commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Set commands
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/actions/use-templates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Use templates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/actions/send-multiple/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Send multiple messages
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/actions/send-media/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Send media and files
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Users
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Users
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/users/extend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extend the user model
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Logging
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Logging
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/logging/setup-basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Set up basic logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/logging/configure-notifications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configure notifications
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/logging/configure-structured/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configure structured logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/logging/configure-rotation-retention/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configure file log rotation and retention
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Projects
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Projects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/projects/other-package-managers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using other package managers
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/kamihi/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>kamihi
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>kamihi
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/kamihi/base/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>base
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_2" id="__nav_5_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>base
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/base/config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>config
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/base/logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/base/manual_send/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>manual_send
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/kamihi/bot/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>bot
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3" id="__nav_5_1_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>bot
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/bot/action/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>action
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/bot/bot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>bot
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/kamihi/bot/models/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>models
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_4" id="__nav_5_1_3_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_4">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/bot/models/registered_action/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>registered_action
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/bot/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/kamihi/cli/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>cli
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_4" id="__nav_5_1_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_4">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>cli
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/cli/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>cli
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_4_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/kamihi/cli/commands/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>commands
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_4_3" id="__nav_5_1_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_4_3">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>commands
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/cli/commands/action/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>action
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/cli/commands/init/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>init
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/cli/commands/run/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>run
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/cli/commands/user/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>user
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/cli/commands/version/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>version
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/kamihi/db/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>db
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_5" id="__nav_5_1_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_5">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>db
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/db/mongo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>mongo
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/kamihi/tg/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>tg
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_6" id="__nav_5_1_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_6">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>tg
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/tg/client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>client
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/tg/default_handlers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>default_handlers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_6_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/kamihi/tg/handlers/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>handlers
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_6_4" id="__nav_5_1_6_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_6_4">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>handlers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/tg/handlers/auth_handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>auth_handler
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/tg/media/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>media
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/tg/send/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>send
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/kamihi/users/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>users
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_7" id="__nav_5_1_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_7">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>users
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_7_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/kamihi/users/models/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>models
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_7_2" id="__nav_5_1_7_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_7_2">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/users/models/permission/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>permission
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/users/models/role/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>role
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/users/models/user/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>user
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/users/users/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>users
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/kamihi/web/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>web
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_8" id="__nav_5_1_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_8">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>web
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/web/views/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>views
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/kamihi/web/web/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>web
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Developers
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Developers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../directories/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Directories
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#unit-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Unit testing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functional-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Functional testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functional testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      Setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#available-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Available fixtures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Available fixtures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-testing-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      Core testing infrastructure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-structure-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Application structure fixtures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-and-database-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Container and database fixtures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Database fixtures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-management-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      User management fixtures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-interface-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Web interface fixtures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Content functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utility-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Utility fixtures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kamihicontainer-methods" class="md-nav__link">
    <span class="md-ellipsis">
      KamihiContainer methods
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Using the fixtures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using the fixtures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-test-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Basic test structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overriding-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Overriding fixtures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overriding fixtures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-level-overrides" class="md-nav__link">
    <span class="md-ellipsis">
      File-level overrides
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-level-overrides" class="md-nav__link">
    <span class="md-ellipsis">
      Function-level overrides
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Common patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-test-media-files" class="md-nav__link">
    <span class="md-ellipsis">
      Using test media files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-cli-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Testing CLI commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-web-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Testing web interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-bot-actions-with-custom-code" class="md-nav__link">
    <span class="md-ellipsis">
      Testing bot actions with custom code
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best practices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            About
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../thanks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Special thanks
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#unit-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Unit testing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functional-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Functional testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functional testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      Setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#available-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Available fixtures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Available fixtures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-testing-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      Core testing infrastructure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-structure-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Application structure fixtures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-and-database-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Container and database fixtures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Database fixtures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-management-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      User management fixtures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-interface-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Web interface fixtures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Content functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utility-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Utility fixtures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kamihicontainer-methods" class="md-nav__link">
    <span class="md-ellipsis">
      KamihiContainer methods
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Using the fixtures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using the fixtures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-test-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Basic test structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overriding-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Overriding fixtures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overriding fixtures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-level-overrides" class="md-nav__link">
    <span class="md-ellipsis">
      File-level overrides
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-level-overrides" class="md-nav__link">
    <span class="md-ellipsis">
      Function-level overrides
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Common patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-test-media-files" class="md-nav__link">
    <span class="md-ellipsis">
      Using test media files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-cli-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Testing CLI commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-web-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Testing web interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-bot-actions-with-custom-code" class="md-nav__link">
    <span class="md-ellipsis">
      Testing bot actions with custom code
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best practices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Testing</h1>

<p>This guide explains how to run and develop tests for the Kamihi project, including unit and functional tests.</p>
<h2 id="unit-testing">Unit testing<a class="headerlink" href="#unit-testing" title="Permanent link">⚓︎</a></h2>
<p>Unit tests are located in the <code>tests/unit</code> directory. They are organized in the same way as the source code, with a folder per module, each with one or more test files that normally correspond to the files in the module.</p>
<p>Unit tests are written using <code>pytest</code>. Once the project has been correctly set up following the <a href="../setup/">setup guide</a>, you just need to install their dependencies and run them:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>uv<span class="w"> </span>sync<span class="w"> </span>--group<span class="w"> </span>unit
$<span class="w"> </span>uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>tests/unit
</code></pre></div>
<h2 id="functional-testing">Functional testing<a class="headerlink" href="#functional-testing" title="Permanent link">⚓︎</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Functional tests make use of automated Docker container deployments, and thus are very resource-intensive. Make sure your machine is powerful enough to handle them.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>As of the time of writing this documentation, it is not possible to run functional tests unless you have an iOS device for the initial setup. This is because for now creating test accounts can only be done through the Telegram app on iOS. This is a limitation of Telegram, not Kamihi.</p>
</div>
<p>Functional tests are located in the <code>tests/functional</code> directory. They are organized by feature, based loosely on the structure of the source code but not constrained by it.</p>
<h3 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">⚓︎</a></h3>
<p>Running functional tests requires a bit more setup, as they run on Telegram's <a href="https://core.telegram.org/api/auth#test-accounts">test accounts</a> (to avoid bans and FLOOD errors). To create the environment needed for them, you can follow these steps:</p>
<ol>
<li>Install the dependencies:
    <div class="highlight"><pre><span></span><code>$<span class="w"> </span>uv<span class="w"> </span>sync<span class="w"> </span>--group<span class="w"> </span>unit<span class="w"> </span>--group<span class="w"> </span>func
</code></pre></div></li>
<li>Make sure you have Docker and Docker Compose installed on your machine.
    <div class="highlight"><pre><span></span><code>$<span class="w"> </span>docker<span class="w"> </span>--version
$<span class="w"> </span>docker<span class="w"> </span>compose<span class="w"> </span>--version
</code></pre></div></li>
<li>Create a <code>.env</code> file in the root of the project with the following content, which we will fill in as we go along:
    <div class="highlight"><pre><span></span><code>KAMIHI_TESTING__BOT_TOKEN=
KAMIHI_TESTING__BOT_USERNAME=
KAMIHI_TESTING__USER_ID=/
KAMIHI_TESTING__TG_PHONE_NUMBER=/
KAMIHI_TESTING__TG_API_ID=/
KAMIHI_TESTING__TG_API_HASH=/
KAMIHI_TESTING__TG_SESSION=/
KAMIHI_TESTING__TG_DC_ID=/
KAMIHI_TESTING__TG_DC_IP=/
</code></pre></div></li>
<li>Go to your Telegram account's developer panel, sign in with your account, and create a new application.</li>
<li>From the 'App configuration' section, you can obtain the values for <code>TG_API_ID</code> (App api_id) and <code>TG_API_HASH</code> (App api_hash).</li>
<li>From the 'Available MTProto Servers' section, you can obtain the values for <code>TG_DC_IP</code> (Text field besides 'Test configuration:') and <code>TG_DC_ID</code> (Number just below the IP, prepended by 'DC'). Beware that <code>TG_DC_ID</code> is just the number, without the 'DC' prefix.</li>
<li>You need an account on the test servers so you don't hit limitations or risk a ban on your main account. To create a test account:<ol>
<li>Get the Telegram app on iOS, if you don't have it already, and log in with your main account (or with any account, really).</li>
<li>Tap the Settings icon in the bottom bar ten times to access the developer settings.</li>
<li>Select 'Accounts', then 'Login to another account', then 'Test'</li>
<li>Input your phone number (must be a valid number that can receive SMS) and tap 'Next', confirm the phone and input the code you receive via SMS.</li>
</ol>
</li>
<li>(optional) You can log in with the test account on the desktop application following this steps:<ol>
<li>Go to the sidebar</li>
<li>While holding Alt and Shift, right-click on the 'Add account' button</li>
<li>Select 'Test server'</li>
<li>Log in by scanning the QR code from the Telegram app on iOS that has the test account</li>
</ol>
</li>
<li>Once you hace the test account created, you can fill the value for <code>TG_PHONE_NUMBER</code> with the one you used for the test account, including international prefix and no spaces or other characters, e.g. +15559786475.</li>
<li>Now you must obtain your test account's Telegram User ID. The easiest is to message one of the many bots that will provide it for you, like <a href="https://t.me/myidbot">this one</a>. This value corresponds to the `USER_ID' environment variable.</li>
<li>For the tests to be able to log in without any user input, two-factor authentication must be skipped. For that to happen, we need a session token. We have a script for that, so to obtain the token, run the following command from the root of the project after having filled in all the values from the previous steps in the <code>.env</code> file:
    <div class="highlight"><pre><span></span><code>$<span class="w"> </span>uv<span class="w"> </span>run<span class="w"> </span>tests/functional/utils/get_string_session.py
</code></pre></div>
    This value can then be added to the <code>.env</code> file in the <code>TG_SESSION</code> variable.</li>
<li>Last, but not least, we need a bot to test on. From your test account, talk to the <a href="https://t.me/botfather">@BotFather</a> and fill in the <code>BOT_TOKEN</code> and <code>BOT_USERNAME</code> values in the <code>.env</code> file.</li>
</ol>
<p>Once this odyssey has been completed, you should be able to run the functional tests with the following command:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>tests/functional
</code></pre></div>
<h3 id="available-fixtures">Available fixtures<a class="headerlink" href="#available-fixtures" title="Permanent link">⚓︎</a></h3>
<p>The functional test suite comes with several convenience fixtures to make writing tests easier:</p>
<h4 id="core-testing-infrastructure">Core testing infrastructure<a class="headerlink" href="#core-testing-infrastructure" title="Permanent link">⚓︎</a></h4>
<ul>
<li><strong><code>test_settings</code></strong> - Provides <code>TestingSettings</code> instance with all configuration values from environment variables and <code>.env</code> file.</li>
<li><strong><code>tg_client</code></strong> - Session-scoped Telegram client for interacting with the test bot, automatically connects and disconnects. Ideally, instead of using this fixture, you should use...</li>
<li><strong><code>chat</code></strong> - Opens a conversation with the test bot using the test user, providing a <code>Conversation</code> object for sending/receiving messages.</li>
</ul>
<h4 id="application-structure-fixtures">Application structure fixtures<a class="headerlink" href="#application-structure-fixtures" title="Permanent link">⚓︎</a></h4>
<p>These fixtures provide the content of the project under test in the container. All of them are dictionaries where the keys represent the paths of the files and the values represent the contents. Directories get created automatically. You can override them to provide custom content for testing:</p>
<ul>
<li><strong><code>pyproject</code></strong> - Returns a dictionary with <code>pyproject.toml</code> as key and the file content as value.</li>
<li><strong><code>config_file</code></strong> - Returns a dictionary with <code>kamihi.yml</code> as key and the file content as value.</li>
<li><strong><code>actions_folder</code></strong> - Dictionary representing the actions folder structure and all its files. Gets <code>actions/</code> prepended to all keys at runtime.</li>
<li><strong><code>models_folder</code></strong> - Dictionary representing the models folder structure and all its files. Gets <code>models/</code> prepended to all keys at runtime.</li>
<li><strong><code>app_folder</code></strong> - Combines all application files into a single dictionary for container mounting. Not to be overridden unless you know what you're doing.</li>
</ul>
<h4 id="container-and-database-fixtures">Container and database fixtures<a class="headerlink" href="#container-and-database-fixtures" title="Permanent link">⚓︎</a></h4>
<ul>
<li><strong><code>mongo_container</code></strong> - MongoDB container instance for database operations.</li>
<li><strong><code>kamihi_container</code></strong> - Custom <code>KamihiContainer</code> instance with enhanced logging and control methods.</li>
<li><strong><code>kamihi</code></strong> - Main fixture that ensures the Kamihi container is started and ready for testing. This is the one you should use in your tests to interact with the Kamihi application, unless for some reason you need to use the application before it is fully started, in which case you can use the <code>kamihi_container</code> fixture directly.</li>
</ul>
<h4 id="database-fixtures">Database fixtures<a class="headerlink" href="#database-fixtures" title="Permanent link">⚓︎</a></h4>
<ul>
<li><strong><code>mongodb</code></strong> - MongoDB client connected to the test database using Pymongo, for manually editing the database during tests.</li>
</ul>
<h4 id="user-management-fixtures">User management fixtures<a class="headerlink" href="#user-management-fixtures" title="Permanent link">⚓︎</a></h4>
<ul>
<li><strong><code>user_custom_data</code></strong> - Dictionary for custom user data (empty by default, can be overridden). To be used with the <code>models_folder</code> fixture to test with custom user models.</li>
<li><strong><code>user_in_db</code></strong> - Creates a test user using the test user ID in the database and returns the user document.</li>
<li><strong><code>add_permission_for_user</code></strong> - Generator fixture that returns a function to add permissions to users for specific actions.</li>
</ul>
<h4 id="web-interface-fixtures">Web interface fixtures<a class="headerlink" href="#web-interface-fixtures" title="Permanent link">⚓︎</a></h4>
<ul>
<li><strong><code>admin_page</code></strong> - Provides an asynchronous Playwright <code>Page</code> object for the Kamihi admin interface.</li>
</ul>
<h4 id="content-functions">Content functions<a class="headerlink" href="#content-functions" title="Permanent link">⚓︎</a></h4>
<p>These are not fixtures, you must import them directly from <code>tests.conftests</code> and use them as normal functions, not in the test function signature:</p>
<ul>
<li><strong><code>random_image()</code></strong> - Returns a random image file in bytes format, useful for testing image uploads.</li>
<li><strong><code>random_video_path()</code></strong> - Returns a random video file path from <code>tests/static/videos</code>, useful for testing video uploads.</li>
<li><strong><code>random_audio_path()</code></strong> - Returns a random audio file path from <code>tests/static/audios</code>, useful for testing audio uploads.</li>
<li><strong><code>random_voice_note_path()</code></strong> - Returns a random voice message file path from <code>tests/static/audios</code>, useful for testing voice messages.</li>
</ul>
<h4 id="utility-fixtures">Utility fixtures<a class="headerlink" href="#utility-fixtures" title="Permanent link">⚓︎</a></h4>
<ul>
<li><strong><code>run_command</code></strong> - Sets the command for running the bot in the container (<code>"kamihi run"</code> by default).</li>
<li><strong><code>sync_and_run_command</code></strong> - UV-wrapped version of the run command. Do not override this unless you know what you're doing, as it will probably make your tests fail.</li>
<li><strong><code>cleanup</code></strong> - Session-scoped fixture that cleans up Docker resources after tests complete.</li>
</ul>
<h4 id="kamihicontainer-methods">KamihiContainer methods<a class="headerlink" href="#kamihicontainer-methods" title="Permanent link">⚓︎</a></h4>
<p>The <code>KamihiContainer</code> class extends the base container with additional methods:</p>
<ul>
<li><strong><code>logs(stream=False)</code></strong> - Get container logs as a list or stream</li>
<li><strong><code>parse_log_json(line)</code></strong> - Parse JSON log entries from the container</li>
<li><strong><code>wait_for_log(message, level="INFO", extra_values=None)</code></strong> - Wait for specific log entries</li>
<li><strong><code>wait_for_message(message)</code></strong> - Wait for messages without JSON parsing</li>
<li><strong><code>assert_logged(level, message)</code></strong> - Assert that a log entry was sent</li>
<li><strong><code>wait_until_started()</code></strong> - Wait until the container is fully started</li>
<li><strong><code>run(command)</code></strong> - Execute commands in the container</li>
<li><strong><code>run_and_wait_for_log(command, message)</code></strong> - Run command and wait for specific log output</li>
<li><strong><code>run_and_wait_for_message(command, message)</code></strong> - Run command and wait for an specific message, without JSON parsing</li>
<li><strong><code>stop()</code></strong> - Gracefully stop the container</li>
</ul>
<h3 id="using-the-fixtures">Using the fixtures<a class="headerlink" href="#using-the-fixtures" title="Permanent link">⚓︎</a></h3>
<h4 id="basic-test-structure">Basic test structure<a class="headerlink" href="#basic-test-structure" title="Permanent link">⚓︎</a></h4>
<p>Most functional tests follow this pattern:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">asyncio</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">usefixtures</span><span class="p">(</span><span class="s2">&quot;kamihi&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_my_feature</span><span class="p">(</span><span class="n">user_in_db</span><span class="p">,</span> <span class="n">add_permission_for_user</span><span class="p">,</span> <span class="n">chat</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test description.&quot;&quot;&quot;</span>
    <span class="c1"># Setup permissions</span>
    <span class="n">add_permission_for_user</span><span class="p">(</span><span class="n">user_in_db</span><span class="p">,</span> <span class="s2">&quot;my_action&quot;</span><span class="p">)</span>

    <span class="c1"># Test interaction</span>
    <span class="k">await</span> <span class="n">chat</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="s2">&quot;/my_command&quot;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">chat</span><span class="o">.</span><span class="n">get_response</span><span class="p">()</span>

    <span class="c1"># Assertions</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;expected response&quot;</span>
</code></pre></div>
<h4 id="overriding-fixtures">Overriding fixtures<a class="headerlink" href="#overriding-fixtures" title="Permanent link">⚓︎</a></h4>
<h5 id="file-level-overrides">File-level overrides<a class="headerlink" href="#file-level-overrides" title="Permanent link">⚓︎</a></h5>
<p>Override fixtures for an entire test file by redefining the fixture:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">run_command</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Override to test without full startup.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;sleep infinity&quot;</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">actions_folder</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom actions for all tests in this file.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;start/__init__.py&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;start/start.py&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">            from kamihi import bot</span>

<span class="s2">            @bot.action</span>
<span class="s2">            async def start():</span>
<span class="s2">                return &quot;Hello World!&quot;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_my_feature</span><span class="p">(</span><span class="n">kamihi</span><span class="p">,</span> <span class="n">chat</span><span class="p">):</span>
    <span class="c1"># All tests in this file use the overridden fixtures</span>
    <span class="k">pass</span>
</code></pre></div>
<h5 id="function-level-overrides">Function-level overrides<a class="headerlink" href="#function-level-overrides" title="Permanent link">⚓︎</a></h5>
<p>Override fixtures for specific tests by decorating individual functions:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;user_custom_data&quot;</span><span class="p">,</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">}])</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;models_folder&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;user.py&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">                from kamihi import bot, BaseUser</span>
<span class="s2">                from mongoengine import StringField</span>

<span class="s2">                @bot.user_class</span>
<span class="s2">                class MyCustomUser(BaseUser):</span>
<span class="s2">                    name: str = StringField()</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_custom_user_model</span><span class="p">(</span><span class="n">user_in_db</span><span class="p">,</span> <span class="n">chat</span><span class="p">,</span> <span class="n">models_folder</span><span class="p">):</span>
    <span class="c1"># This test uses custom user model and data</span>
    <span class="k">pass</span>
</code></pre></div>
<h4 id="common-patterns">Common patterns<a class="headerlink" href="#common-patterns" title="Permanent link">⚓︎</a></h4>
<h5 id="using-test-media-files">Using test media files<a class="headerlink" href="#using-test-media-files" title="Permanent link">⚓︎</a></h5>
<p>You can use the provided utility functions to add media files to your tests:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">asyncio</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">usefixtures</span><span class="p">(</span><span class="s2">&quot;kamihi&quot;</span><span class="p">)</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;actions_folder&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;start/__init__.py&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;start/start.py&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">                    from pathlib import Path</span>
<span class="s2">                    from kamihi import bot</span>

<span class="s2">                    @bot.action</span>
<span class="s2">                    async def start() -&gt; list[bot.Photo]:</span>
<span class="s2">                        return [</span>
<span class="s2">                            bot.Photo(Path(&quot;actions/start/image.jpg&quot;)),</span>
<span class="s2">                            bot.Video(Path(&quot;actions/start/video.mp4&quot;)),</span>
<span class="s2">                            bot.Audio(Path(&quot;actions/start/audio.mp3&quot;)),</span>
<span class="s2">                            bot.Voice(Path(&quot;actions/start/audio.m4a&quot;)),</span>
<span class="s2">                        ]</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;start/image.jpg&quot;</span><span class="p">:</span> <span class="n">random_image</span><span class="p">(),</span>
                <span class="s2">&quot;start/video.mp4&quot;</span><span class="p">:</span> <span class="n">random_video_path</span><span class="p">()</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">(),</span>
                <span class="s2">&quot;start/audio.mp3&quot;</span><span class="p">:</span> <span class="n">random_audio_path</span><span class="p">()</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">(),</span>
                <span class="s2">&quot;start/audio.m4a&quot;</span><span class="p">:</span> <span class="n">random_voice_note_path</span><span class="p">()</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">(),</span>
            <span class="p">},</span>
        <span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">actions_folder</span><span class="p">):</span> <span class="o">...</span>
</code></pre></div>
<h5 id="testing-cli-commands">Testing CLI commands<a class="headerlink" href="#testing-cli-commands" title="Permanent link">⚓︎</a></h5>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_cli_validation</span><span class="p">(</span><span class="n">kamihi</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test invalid CLI parameters.&quot;&quot;&quot;</span>
    <span class="n">kamihi</span><span class="o">.</span><span class="n">run_and_wait_for_message</span><span class="p">(</span>
        <span class="s2">&quot;kamihi run --port=invalid&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Invalid value for &#39;--port&#39;&quot;</span>
    <span class="p">)</span>
</code></pre></div>
<p>If testing the <code>kamihi run</code> command, you can override the <code>run_command</code> fixture to avoid starting the application twice, which will generate conflicts:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">run_command</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Override to test CLI without full application startup.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;sleep infinity&quot;</span>
</code></pre></div>
<h5 id="testing-web-interface">Testing web interface<a class="headerlink" href="#testing-web-interface" title="Permanent link">⚓︎</a></h5>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">asyncio</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_web_feature</span><span class="p">(</span><span class="n">admin_page</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test admin interface functionality.&quot;&quot;&quot;</span>
    <span class="k">await</span> <span class="n">admin_page</span><span class="o">.</span><span class="n">get_by_role</span><span class="p">(</span><span class="s2">&quot;link&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Users&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">admin_page</span><span class="o">.</span><span class="n">get_by_role</span><span class="p">(</span><span class="s2">&quot;button&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;+ New User&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="c1"># Continue with Playwright interactions</span>
</code></pre></div>
<h5 id="testing-bot-actions-with-custom-code">Testing bot actions with custom code<a class="headerlink" href="#testing-bot-actions-with-custom-code" title="Permanent link">⚓︎</a></h5>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;actions_folder&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;greet/__init__.py&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;greet/greet.py&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">                from kamihi import bot</span>

<span class="s2">                @bot.action</span>
<span class="s2">                async def greet(user):</span>
<span class="s2">                    return f&quot;Hello </span><span class="si">{user.telegram_id}</span><span class="s2">!&quot;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_greeting</span><span class="p">(</span><span class="n">user_in_db</span><span class="p">,</span> <span class="n">add_permission_for_user</span><span class="p">,</span> <span class="n">chat</span><span class="p">,</span> <span class="n">actions_folder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test custom greeting action.&quot;&quot;&quot;</span>
    <span class="n">add_permission_for_user</span><span class="p">(</span><span class="n">user_in_db</span><span class="p">,</span> <span class="s2">&quot;greet&quot;</span><span class="p">)</span>

    <span class="k">await</span> <span class="n">chat</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="s2">&quot;/greet&quot;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">chat</span><span class="o">.</span><span class="n">get_response</span><span class="p">()</span>

    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_in_db</span><span class="p">[</span><span class="s1">&#39;telegram_id&#39;</span><span class="p">])</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</code></pre></div>
<h3 id="best-practices">Best practices<a class="headerlink" href="#best-practices" title="Permanent link">⚓︎</a></h3>
<ul>
<li><strong>Use <code>@pytest.mark.usefixtures("kamihi")</code></strong> when you need the container running but don't directly interact with it</li>
<li><strong>Always add permissions</strong> before testing bot actions using <code>add_permission_for_user</code>, otherwise the bot will respond with the default message.</li>
<li><strong>Use <code>dedent()</code></strong> for multiline code strings to maintain readable indentation</li>
<li><strong>Override <code>run_command</code></strong> to <code>"sleep infinity"</code> when testing CLI without full application startup</li>
<li><strong>Parametrize at file level</strong> when multiple tests need the same overrides</li>
<li><strong>Do not use test classes</strong>; functional tests should be simple functions</li>
<li><strong>Use meaningful test descriptions</strong> that explain the specific scenario being tested</li>
<li><strong>Use <code>wait_for_log</code></strong> with specific log levels, messages and extra dictionary contents, if there should be any.</li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../setup/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Development setup">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Development setup
              </div>
            </div>
          </a>
        
        
          
          <a href="../documentation/" class="md-footer__link md-footer__link--next" aria-label="Next: Documentation">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Documentation
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.indexes", "navigation.top", "navigation.footer", "toc.follow", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../termynal.js"></script>
      
    
  </body>
</html>